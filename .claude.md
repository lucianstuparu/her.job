# inst.job - Claude Instructions

## Purpose
Research repository for peacebuilding work in Kazakhstan, conducted within CCDP Geneva framework.

## Document Structure

Each thematic area contains:
- `README.md` - Overview and key topics
- `citations.md` - Academic references and key texts
- `notes.md` - Quick thoughts and observations
- `essays/` - Developed pieces and analysis
- `presentations/` - Slides and presentation materials
- `plans/` - Project plans and intervention designs

## Shortcuts

### #add-citation: [Quick citation capture]
Add a citation to a thematic area's citations.md file.

**Usage:**
```
#add-citation [thematic-area]:
Author, Year
Full citation text
Key ideas: ...
```

**Example:**
```
#add-citation conflict-resolution:
Lederach, 1997
Building Peace: Sustainable Reconciliation in Divided Societies
Key ideas: middle-range leadership, long-term commitment, relationship building
```

### #add-note: [Quick note capture]
Add a quick note, thought, or observation to a thematic area.

**Usage:**
```
#add-note [thematic-area]:
Your note or thought here
```

**Example:**
```
#add-note astana:
Key insight from stakeholder meeting - local organizations prefer collaborative over top-down approaches
```

### #add-thought: [Quick thought capture]
Alias for #add-note - captures reflections and ideas.

**Usage:**
```
#add-thought [thematic-area]:
Your thought here
```

## Thematic Areas

Use these area names with shortcuts:
- `conflict-resolution` (or `conflict`)
- `dialogue-and-mediation` (or `dialogue`)
- `policy-and-advocacy` (or `policy`)
- `education-and-training` (or `education`)
- `community-building` (or `community`)
- `gender-and-inclusion` (or `gender`)
- `astana-visit` (or `astana`)

## Common Tasks

### Adding Citations
When adding citations, always include:
1. Author and year
2. Full citation in proper format
3. Key ideas (bullet points)
4. Relevance to your work
5. Tags for cross-referencing

### Adding Notes
- Always add date (YYYY-MM-DD format)
- Keep notes concise and focused
- Use tags (#keyword) for easy searching
- Link to related thematic areas when relevant

### Developing Ideas
When notes accumulate on a topic:
1. Review related notes and citations
2. Identify key themes
3. Create an essay/presentation/plan in the appropriate folder
4. Link back to source citations and notes

## Tags for Cross-Referencing

Use hashtags to create connections:
- `#theory` - Theoretical frameworks
- `#practice` - Practical applications
- `#case-study` - Real-world examples
- `#research` - Academic research
- `#tools` - Methods and tools
- `#reflection` - Personal reflections

## Working with Claude Code

You can ask Claude to:
- Add citations to specific thematic areas
- Capture quick notes or thoughts
- Search across all thematic areas for specific topics
- Help develop notes into essays or presentations
- Suggest connections between different thematic areas
- Format citations properly
- Create new project plans or presentation outlines
### #todo: [Quick issue creation]
Create a GitHub issue with automatic deadline and status detection.

**Usage:**
```
#todo: Task description with optional deadline and status keywords
```

**Examples:**
```
#todo: Request return for edel-optics.fr deadline 10 feb

#todo: Book flights to Bucharest for Feb 9th - next

#todo: Schedule vaccine appointment in 1 month

#todo: Review document by 2026-02-20 in-progress
```

**How it works:**
- Claude parses the text and cleans up the title
- Detects dates in various formats (Feb 10, 2026-02-15, in 1 month, etc.)
- Detects status keywords: todo, next, in-progress, done
- Calls `.metadata/scripts/add-issue.sh` with extracted parameters
- Issue is automatically added to the GitHub Project

**Deadline formats recognized:**
- `deadline 10 feb` → 2026-02-10
- `by 2026-02-15` → 2026-02-15
- `Feb 9` or `Feb 9th` → 2026-02-09
- `in 1 month` → calculated date

**Status keywords:**
- `todo` → Todo status
- `next` → Next status
- `in-progress` or `in progress` → In Progress status
- `done` → Done status

## GitHub Issue Management

### Authentication
GitHub Personal Access Token is available in the `GH_TOKEN` environment variable.

### Creating Issues
Use the GitHub API to create issues directly:

**Single issue:**
```bash
curl -s -X POST \
  -H "Authorization: token $GH_TOKEN" \
  -H "Accept: application/vnd.github.v3+json" \
  https://api.github.com/repos/lucianstuparu/inst.job/issues \
  -d '{"title":"Issue title here"}'
```

**With body:**
```bash
curl -s -X POST \
  -H "Authorization: token $GH_TOKEN" \
  -H "Accept: application/vnd.github.v3+json" \
  https://api.github.com/repos/lucianstuparu/inst.job/issues \
  -d '{"title":"Issue title", "body":"Detailed description here"}'
```

### Updating Issue Titles
```bash
curl -s -X PATCH \
  -H "Authorization: token $GH_TOKEN" \
  -H "Accept: application/vnd.github.v3+json" \
  https://api.github.com/repos/lucianstuparu/inst.job/issues/ISSUE_NUMBER \
  -d '{"title":"Updated title here"}'
```

### Listing Issues
```bash
# List all open issues
curl -s -H "Authorization: token $GH_TOKEN" \
  -H "Accept: application/vnd.github.v3+json" \
  "https://api.github.com/repos/lucianstuparu/inst.job/issues?state=open&per_page=100"
```

### Project Integration
- The `add-issue.sh` script directly adds issues to the project
- The "Auto-add to project" workflow can be disabled (script handles it)
- Project filter: `is:issue is:open`
- Issue changes sync automatically, but project-specific fields must be updated via GraphQL

## GitHub Project V2 Management

**Project:** "Peacebuilding Research" (Project #4)
- **Project ID:** `PVT_kwHOAKRZo84BON5B`
- **URL:** https://github.com/users/lucianstuparu/projects/4

### Custom Fields
- **Status** (Single Select):
  - Todo (ID: `ac9844cf`) - Default for new issues
  - Next (ID: `acd48498`)
  - In Progress (ID: `4fba7b52`)
  - Done (ID: `cce8eea9`)
  - Field ID: `PVTSSF_lAHOAKRZo84BON5Bzg8-9t0`

- **Deadline** (Date):
  - Field ID: `PVTF_lAHOAKRZo84BON5Bzg8-93o`

### Query Project Items
```bash
curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d '{"query":"query { node(id: \"PVT_kwHOAKRZo84BON5B\") { ... on ProjectV2 { items(first: 50) { nodes { id content { ... on Issue { number title } } } } } } }"}' \
  https://api.github.com/graphql
```

### Update Project Item Status
```bash
# Example: Set issue to "Todo"
PROJECT_ID="PVT_kwHOAKRZo84BON5B"
ITEM_ID="PVTI_..." # Get from query above
STATUS_FIELD_ID="PVTSSF_lAHOAKRZo84BON5Bzg8-9t0"
STATUS_OPTION_ID="f75ad846"  # "Todo"

curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d "{\"query\":\"mutation { updateProjectV2ItemFieldValue(input: {projectId: \\\"$PROJECT_ID\\\", itemId: \\\"$ITEM_ID\\\", fieldId: \\\"$STATUS_FIELD_ID\\\", value: {singleSelectOptionId: \\\"$STATUS_OPTION_ID\\\"}}) { projectV2Item { id } } }\"}" \
  https://api.github.com/graphql
```

### Update Project Item Deadline
```bash
# Example: Set deadline to Feb 9, 2026
PROJECT_ID="PVT_kwHOAKRZo84BON5B"
ITEM_ID="PVTI_..." # Get from query above
DEADLINE_FIELD_ID="PVTF_lAHOAKRZo84BON5Bzg8-93o"

curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d "{\"query\":\"mutation { updateProjectV2ItemFieldValue(input: {projectId: \\\"$PROJECT_ID\\\", itemId: \\\"$ITEM_ID\\\", fieldId: \\\"$DEADLINE_FIELD_ID\\\", value: {date: \\\"2026-02-09\\\"}}) { projectV2Item { id } } }\"}" \
  https://api.github.com/graphql
```

## Helper Scripts

### add-issue.sh
Create GitHub issues with automatic project integration, deadline, and status.

**Location:** `.metadata/scripts/add-issue.sh`

**Usage:**
```bash
./metadata/scripts/add-issue.sh "Issue title" [deadline YYYY-MM-DD] [status: todo|next|in-progress|done]
```

**Examples:**
```bash
# Simple issue
./metadata/scripts/add-issue.sh "Fix the bug"

# With deadline
./metadata/scripts/add-issue.sh "Submit report" 2026-02-15

# With deadline and status
./metadata/scripts/add-issue.sh "Review document" 2026-02-20 next

# Just status (no deadline)
./metadata/scripts/add-issue.sh "Quick task" in-progress
```

**Features:**
- Creates issue in repository
- Directly adds issue to project (no wait needed)
- Sets deadline if provided
- Sets status if provided
- Error handling and validation

**Note:** This script adds issues to the project directly, so the "Auto-add to project" workflow can be disabled if desired.

## Common Workflows

### Find Project Item ID for an Issue
```bash
# Get the last 10 items (most recent)
curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d '{"query":"query { node(id: \"PVT_kwHOAKRZo84BON5B\") { ... on ProjectV2 { items(last: 10) { nodes { id content { ... on Issue { number title } } } } } } }"}' \
  https://api.github.com/graphql
```

### Create Issue and Set Deadline (Complete Workflow)
```bash
# 1. Create the issue
ISSUE_RESPONSE=$(curl -s -X POST \
  -H "Authorization: token $GH_TOKEN" \
  -H "Accept: application/vnd.github.v3+json" \
  https://api.github.com/repos/lucianstuparu/inst.job/issues \
  -d '{"title":"Your task title here"}')

ISSUE_NUMBER=$(echo "$ISSUE_RESPONSE" | grep -o '"number": *[0-9]*' | head -1 | grep -o '[0-9]*')
ISSUE_NODE_ID=$(echo "$ISSUE_RESPONSE" | grep -o '"node_id": *"[^"]*"' | head -1 | sed 's/"node_id": *"\([^"]*\)"/\1/')
echo "Created issue #$ISSUE_NUMBER"

# 2. Add issue to project directly
ADD_RESPONSE=$(curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d "{\"query\":\"mutation { addProjectV2ItemById(input: {projectId: \\\"PVT_kwHOAKRZo84BON5B\\\", contentId: \\\"$ISSUE_NODE_ID\\\"}) { item { id } } }\"}" \
  https://api.github.com/graphql)

ITEM_ID=$(echo "$ADD_RESPONSE" | grep -o '"id":"PVTI_[^"]*"' | head -1 | sed 's/"id":"\([^"]*\)"/\1/')
echo "Added to project (Item ID: $ITEM_ID)"

# 3. Set the deadline
curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d "{\"query\":\"mutation { updateProjectV2ItemFieldValue(input: {projectId: \\\"PVT_kwHOAKRZo84BON5B\\\", itemId: \\\"$ITEM_ID\\\", fieldId: \\\"PVTF_lAHOAKRZo84BON5Bzg8-93o\\\", value: {date: \\\"2026-02-10\\\"}}) { projectV2Item { id } } }\"}" \
  https://api.github.com/graphql

echo "Deadline set for issue #$ISSUE_NUMBER"
```

### Update Issue Status in Project
```bash
# Example: Move issue #25 to "Next" status
# 1. Get project item ID (from recent items)
ITEM_ID=$(curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d '{"query":"query { node(id: \"PVT_kwHOAKRZo84BON5B\") { ... on ProjectV2 { items(last: 10) { nodes { id content { ... on Issue { number } } } } } } }"}' \
  https://api.github.com/graphql | grep -o 'PVTI_[^"]*","content":{"number":25' | sed 's/","content.*//')

# 2. Update status to "Next"
curl -s -X POST -H "Authorization: bearer $GH_TOKEN" -H "Content-Type: application/json" \
  -d "{\"query\":\"mutation { updateProjectV2ItemFieldValue(input: {projectId: \\\"PVT_kwHOAKRZo84BON5B\\\", itemId: \\\"$ITEM_ID\\\", fieldId: \\\"PVTSSF_lAHOAKRZo84BON5Bzg8-9t0\\\", value: {singleSelectOptionId: \\\"34c960b0\\\"}}) { projectV2Item { id } } }\"}" \
  https://api.github.com/graphql
```

### Quick Reference - Status Option IDs
- Todo: `ac9844cf`
- Next: `acd48498`
- In Progress: `4fba7b52`
- Done: `cce8eea9`

### Note
- Use GraphQL API (not REST) for Project V2 operations
- Token requires `project` scope (Classic PAT recommended)
- Issue changes sync automatically, but project-specific fields must be updated via GraphQL
- Use `addProjectV2ItemById` mutation to add issues directly to project
- Use `last: N` in GraphQL queries to get most recent items
